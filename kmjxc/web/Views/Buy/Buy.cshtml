@{
    ViewBag.Title = "验货单查询列表";
    Layout = "~/Views/Shared/master_default.cshtml";
}
<script>
    var buyMgr = new KMJXCBuyManager();
    var pdtMgr = new KMJXCProductManager();
    var $grid = null;
    $(function () {

        var obj = {
            width: 830, height: 600, title: "采购订单验货单查询", flexHeight: true, sortable: false, selectionModel: { mode: 'range' }, scrollModel: { pace: 'fast', horizontal: true },
            rowSelect: function (event, obj) {

            }
        };

        obj.colModel = [{
                            title: "编号", width: 100, dataType: "integer", dataIndx: "ID", editable: false,
                            render: function (ui) {
                                return "<a target=\"_blank\" href=\"/Buy/BuyDetail/" + ui.rowData["ID"] + "\">" + ui.rowData["ID"] + "</a>";
                            }
                        },
                       {
                           title: "采购单编号", width: 150, dataType: "string", dataIndx: "Order.ID", editable: false,
                           render: function (ui) {
                               return "<a target=\"_blank\" href=\"/Buy/BuyOrderDetail/" + ui.rowData["Order"]["ID"] + "\">" + ui.rowData["Order"]["ID"] + "</a>";
                           }
                       },
                       { title: "采购员", width: 150, dataType: "string", dataIndx: "Order.Created_By.Mall_Name", editable: false },
                       { title: "验货人", width: 150, dataType: "string", dataIndx: "User.Mall_Name", editable: false },                       
                       { title: "验货日期", width: 150, dataType: "timestamp", dataIndx: "Created", editable: false },
                       {
                           title: "状态", width: 150, dataType: "string", dataIndx: "Status", editable: false, render: function (ui) {
                               var cellData = ui.rowData["Status"];
                               if (cellData == 0) {
                                   return "未入库";
                               } else if (cellData == 1) {
                                   return "已经入库";
                               } 
                           }
                       },

        ];

        obj.dataModel = {
            location: "remote",
            sorting: "remote",
            paging: "remote",
            dataType: "JSON",
            method: "POST",
            curPage: 1,
            rPP: 30,
            sortIndx: 2,
            sortDir: "up",
            rPPOptions: [50, 60, 100],
            getUrl: function (prgrid) {
                return {
                    url: "/api/Products/GetBuys", data: "page=" + this.curPage + "&pageSize=" + this.rPP
                };
            },
            getData: function (dataJSON) {
                return { curPage: dataJSON.curPage, totalRecords: dataJSON.totalRecords, data: dataJSON.data };
            }
        };

        $("#buytable").on("pqgridrender", function (evt, obj) {
            var $toolbar = $("<div class='pq-grid-toolbar pq-grid-toolbar-crud'></div>").appendTo($(".pq-grid-top", this));
            $("<span id=\"add_cate\">入库</span>").appendTo($toolbar).button({ icons: { primary: "ui-icon-circle-plus" } }).click(function (e) {
                var rowIndx = getRowIndx();
                var DM = $grid.pqGrid("option", "dataModel");
                var data = DM.data;
                var row = data[rowIndx];
                var oid = row["ID"]
                var status = row["Status"];
            });
        });

        $grid = $("#buytable").pqGrid(obj);

        function getRowIndx() {
            var arr = $grid.pqGrid("selection", { type: 'row', method: 'getSelection' });
            if (arr && arr.length > 0) {
                var rowIndx = arr[0].rowIndx;

                //if (rowIndx != null && colIndx == null) {
                return rowIndx;
            }
            else {
                alert("请选择一行");
                return null;
            }
        }
    });
</script>
<div class="normallist">
     <div id="buytable"></div>
</div>
